/**
 * 计分板 - 完全自适应布局
 * 优先级：1.显示完整 2.格子大小 3.字体大小
 * 根据每个格子的最大内容长度优化字体
 */

.board {
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  background: var(--bg-card);
  overflow: hidden;
  padding: 0;
  box-sizing: border-box;
  container-type: size;
  container-name: scoreboard;
  /* 支持全屏滑动 */
  touch-action: none;
  user-select: none;
  /* 取消区域需要相对定位 */
  position: relative;
}

/* 滑动选择模式时的样式 */
.board.dragging {
  cursor: grabbing;
}

.table {
  width: 100%;
  height: 100%;
  border-collapse: collapse;
  table-layout: fixed;
  border: 1px solid var(--border-light);
}

/* 列宽定义 */
.categoryCol {
  width: 15%;
}

.playerCol {
  /* 玩家列均分剩余空间 */
}

/* 
 * 统一所有单元格
 * 17行视觉内容，每行约5.8%高度
 * 普通分数最多3字符，可以用较大字体
 */
.table th,
.table td {
  padding: 0 0.3cqw;
  text-align: center;
  vertical-align: middle;
  border: 1px solid var(--border-light);
  color: var(--text);
  line-height: 1.15;
  /* 普通分数(1-3位数)：尽量填满格子高度，宽度留余量 */
  font-size: min(4cqh, 2.5cqw);
  white-space: nowrap;
  overflow: visible;
}

@supports not (font-size: 1cqh) {
  .table th,
  .table td {
    font-size: min(4vh, 2.5vw);
  }
}

/* ===== 表头行 ===== */
.playerHeader {
  --player-color: var(--primary);
  background: var(--bg-muted);
  font-weight: 600;
  border-bottom: 2px solid var(--player-color) !important;
}

.playerHeader.activePlayer {
  background: var(--player-color);
  color: #fff;
}

.playerHeader.localPlayerHeader:not(.activePlayer) {
  background: color-mix(in srgb, var(--player-color) 20%, transparent);
}

.playerName {
  display: block;
  white-space: nowrap;
  padding: 0;
}

.playerNameWrapper {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  gap: 0.2cqh;
}

/* 玩家名(P1-P8)：2字符，可以较大 */
.playerNameText {
  text-align: center;
  font-weight: 600;
  white-space: nowrap;
  line-height: 1.15;
  font-size: min(4cqh, 2.2cqw);
}

/* 标签(你/XXms/AI)：3-6字符，稍小 */
.latencyBadge {
  padding: 0 0.4cqw;
  background: rgba(128, 128, 128, 0.3);
  color: var(--text-secondary);
  font-size: min(2.5cqh, 1.5cqw);
  font-weight: 500;
  border-radius: 2px;
  font-family: monospace;
  white-space: nowrap;
  line-height: 1.15;
}

.youTag {
  display: inline-block;
  font-size: min(2.2cqh, 1.3cqw);
  padding: 0 0.3cqw;
  background: var(--accent);
  color: #000;
  border-radius: 2px;
  white-space: nowrap;
  line-height: 1.15;
}

.aiTag {
  display: inline-block;
  font-size: min(2.2cqh, 1.3cqw);
  padding: 0 0.3cqw;
  background: var(--accent);
  color: #000;
  border-radius: 2px;
  white-space: nowrap;
  line-height: 1.15;
}

/* 重连中徽章 */
.reconnectingBadge {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0 0.4cqw;
  background: rgba(212, 168, 80, 0.3);
  border-radius: 2px;
}

.reconnectingSpinner {
  width: min(2.5cqh, 1.5cqw);
  height: min(2.5cqh, 1.5cqw);
  border: 1px solid rgba(212, 168, 80, 0.3);
  border-top-color: var(--accent);
  border-radius: 50%;
  animation: spinnerRotate 0.8s linear infinite;
}

@keyframes spinnerRotate {
  to { transform: rotate(360deg); }
}

.playerHeader.reconnecting {
  opacity: 0.7;
}

.playerNameContainer {
  display: block;
  width: 100%;
}

.categoryHeader {
  text-align: center !important;
  vertical-align: middle;
  background: var(--bg-muted);
  white-space: nowrap;
}

/* ===== 回合信息 ===== */
.roundCell {
  text-align: center !important;
  vertical-align: middle;
  background: var(--bg-muted);
}

.roundInfo {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  gap: 0;
}

/* "回合"：2字符 */
.roundLabel {
  font-size: 0.7em;
  font-weight: 500;
  color: var(--text-secondary);
  line-height: 1.15;
  white-space: nowrap;
}

/* "X/12"：4字符 */
.roundNumber {
  font-size: 1em;
  font-weight: 700;
  color: var(--accent);
  line-height: 1.15;
  white-space: nowrap;
}

/* ===== 分区标题("排列组合名"5字符) ===== */
.sectionHeader {
  text-align: center !important;
  background: var(--bg-muted);
  font-weight: 700;
  color: var(--text-secondary);
  /* "排列组合名" 5字符，需要较小字体 */
  font-size: min(3.5cqh, 2.8cqw) !important;
}

.sectionRow td {
  background: var(--bg-muted);
  font-weight: 700;
  color: var(--text-secondary);
  text-align: center !important;
}

/* ===== 记分项名称(最长"四骰同花"4字符) ===== */
.categoryName {
  text-align: center !important;
  color: var(--text-secondary);
  background: var(--bg-card);
  white-space: nowrap;
  /* 第一列15%宽度，4字符内容 */
  font-size: min(4cqh, 3.5cqw);
}

/* ===== 分数单元格(1-3位数) ===== */
.scoreCell {
  font-weight: 600;
  cursor: default;
  transition: background 0.15s;
}

.scoreCell.currentPlayer {
  background: rgba(212, 168, 80, 0.15);
}

.scoreCell.available {
  background: rgba(90, 154, 106, 0.2);
  cursor: pointer;
}

.scoreCell.available:hover {
  background: rgba(90, 154, 106, 0.35);
}

/* 滑动选择时的高亮效果 */
.scoreCell.hovered {
  background: rgba(90, 154, 106, 0.5) !important;
  transform: scale(1.05);
  box-shadow: 0 0 8px rgba(90, 154, 106, 0.6);
  z-index: 10;
  position: relative;
}

.scoreCell.filled {
  color: var(--text);
}

.scoreCell.zero {
  color: var(--text-muted);
}

.previewScore {
  color: var(--primary);
  font-weight: 700;
}

.emptyScore {
  color: var(--text-muted);
}

.zeroScore {
  color: var(--text-muted);
}

/* ===== 小计行(XX/63 = 5字符) ===== */
.subtotalRow td {
  background: var(--bg-muted);
  font-weight: 600;
  color: var(--text-secondary);
}

.subtotalRow td:first-child {
  text-align: center !important;
  /* "小计" 2字符，可以较大 */
}

.subtotalCell {
  /* 5字符内容，需要较小字体 */
  font-size: min(3.2cqh, 1.8cqw) !important;
}

/* ===== 奖励分行(+35 = 3字符，但第一列"奖励分+35"有5字符) ===== */
.bonusRow td {
  background: var(--bg-muted);
  font-weight: 600;
  color: var(--text-secondary);
}

.bonusRow td:first-child {
  text-align: center !important;
  /* "奖励分+35" 5字符，需要较小字体 */
  font-size: min(3.5cqh, 2.8cqw) !important;
}

.bonusCell {
  /* 奖励分3字符，与普通分数类似 */
}

.bonusEarned {
  color: var(--primary) !important;
  font-weight: 700;
}

/* ===== 奖励提示行(长文本) ===== */
.hintRow td {
  background: var(--bg-card);
  font-weight: 700;
  color: var(--text-muted);
  text-align: center !important;
  /* 长文本，需要更小字体 */
  font-size: min(2.8cqh, 1.2cqw) !important;
}

/* ===== 总分行("总计点数"4字符，分数3位数) ===== */
.totalRow td {
  background: var(--bg-muted);
  color: var(--text);
  font-weight: 700;
}

.totalRow td:first-child {
  text-align: center !important;
}

.totalCell {
  color: var(--accent);
  font-weight: 700;
}

/* ===== 竖屏优化 ===== */
@media (orientation: portrait) {
  .categoryCol {
    width: 18%;
  }

  .table th,
  .table td {
    font-size: min(4cqh, 4cqw);
  }

  .playerNameText {
    font-size: min(4cqh, 3.5cqw);
  }

  .latencyBadge {
    font-size: min(2.5cqh, 2.5cqw);
  }

  .youTag,
  .aiTag {
    font-size: min(2.2cqh, 2cqw);
  }

  .reconnectingSpinner {
    width: min(2.5cqh, 2.5cqw);
    height: min(2.5cqh, 2.5cqw);
  }

  /* 第一列"四骰同花"等4字符 */
  .categoryName {
    font-size: min(4cqh, 4cqw);
  }

  .subtotalCell {
    font-size: min(3.2cqh, 3cqw) !important;
  }

  .hintRow td {
    font-size: min(2.8cqh, 2cqw) !important;
  }
}
